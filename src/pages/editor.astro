---
import { CldUploadWidget, CldImage } from "astro-cloudinary"
import Layout from "../layouts/Layout.astro"

import Button from "fulldev-ui/components/Button.astro"
import Heading from "fulldev-ui/components/Heading.astro"

import { getCollection } from "astro:content"
// const images = await getCollection("images")
---
<Layout title="Cloudinary Hackathon">
    <main>
      <h1>asdgasdg</h1>
      <CldUploadWidget
        uploadPreset="upload-unsigned-images"
      >
        <button>asfas</button>
      </CldUploadWidget>
      <!-- <ul>
        {
          images.map((image) => {
            return (
              <li>
                <a href={`/photo?id=${image.data.public_id}`}>
                  <CldImage
                    src={image.data.public_id}
                    width={250}
                    height={250}
                    crop={{
                      type: "fill",
                      source: true,
                    }}
                  />
                </a>
              </li>
            )
          })
        }
      </ul> -->
    </main>
  
    <script>
      import { navigate } from "astro:transitions/client"
  
      const widget = document.getElementById("upload-widget")
  
      if (widget) {
        widget.addEventListener("clduploadwidget:success", ((
          e: CustomEvent<{ info: { public_id: string } }>
        ) => {
          const publicId = e.detail.info.public_id
          navigate(`/photo?id=${publicId}`)
        }) as EventListener)
      }
    </script>
  </Layout>